<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Simple eCommerce (Google Sheet + Cart)</title>
<style>
  :root{
    --bg: #0f172a;
    --card-bg: #ffffff;
    --muted: #475569;
    --accent: #0284C7;
    --text: #0b1220;
    --contrast-text: #ffffff;
  }
  body{
    font-family: system-ui, Arial, sans-serif;
    background: var(--bg);
    color: var(--contrast-text);
    padding: 28px;
    margin: 0;
  }
  main.container{ max-width:1200px; margin:0 auto; }

  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
  }

  h1{ margin:0; font-size:22px; color:#eaf6ff; }

  /* CART BUTTON */
  #btnCart{
    background: var(--accent);
    border:none;
    color:#fff;
    font-weight:700;
    padding:8px 14px;
    border-radius:6px;
    cursor:pointer;
  }

  /* Grid */
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap:18px;
    margin-top:12px;
  }

  /* Card */
  .card{
    background: var(--card-bg);
    color: var(--text);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(2,132,199,0.12);
    display:flex;
    flex-direction:column;
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{ transform: translateY(-6px); box-shadow: 0 20px 48px rgba(2,132,199,0.18); }

  .card-head{
    padding:12px 14px;
    border-bottom: 1px solid rgba(2,132,199,0.06);
    font-weight:700;
  }

  .img-wrap{
    position:relative;
    width:100%;
    background:#f1f5f9;
    cursor:pointer;
  }
  .thumb{
    width:100%;
    height:200px;
    object-fit:cover;
    display:block;
  }

  .card-body{
    padding:12px 14px;
    display:flex;
    flex-direction:column;
    gap:8px;
    flex:1;
  }

  .price{ font-weight:700; color: #0b1220; font-size:16px; }
  .desc{ color:var(--muted); font-size:14px; line-height:1.4; }

  .btn-add{
    background: var(--accent);
    border:none;
    color:white;
    font-weight:600;
    padding:8px;
    border-radius:6px;
    cursor:pointer;
    margin-top:auto;
  }
  .btn-add:hover{ background:#0369a1; }

  /* Cart panel */
  .cart-panel{
    position:fixed;
    top:0; right:0;
    width:300px;
    height:100%;
    background:var(--card-bg);
    color:var(--text);
    box-shadow:-4px 0 20px rgba(0,0,0,0.2);
    padding:16px;
    transform:translateX(100%);
    transition: transform .3s ease;
    z-index:1000;
  }
  .cart-panel.open{ transform:translateX(0); }
  .cart-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-weight:700;
    margin-bottom:10px;
  }
  .cart-items{ max-height:70vh; overflow-y:auto; margin-bottom:10px; }
  .cart-item{ border-bottom:1px solid #ddd; padding:8px 0; }
  .cart-total{ font-weight:700; margin-bottom:12px; }
  .btn-checkout{
    background:var(--accent);
    border:none;
    color:white;
    width:100%;
    padding:10px;
    font-weight:700;
    border-radius:6px;
    cursor:pointer;
  }

  /* Image modal */
  .img-modal{
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.9);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:2000;
    opacity:0;
    visibility:hidden;
    transition: opacity 0.25s ease;
  }
  .img-modal.open{
    opacity:1;
    visibility:visible;
  }
  .img-modal img{
    max-width:90%;
    max-height:90%;
    border-radius:10px;
  }
  .img-modal button{
    position:absolute;
    top:20px;
    right:20px;
    background:none;
    border:none;
    color:white;
    font-size:28px;
    cursor:pointer;
  }

  @media (max-width:420px){
    .thumb{ height:160px; }
  }
</style>
</head>
<body>
  <header>
    <h1>My Store</h1>
    <button id="btnCart" aria-label="View shopping cart">Cart (0)</button>
  </header>

  <main class="container">
    <div id="notice">Loading…</div>
    <div id="grid" class="grid"></div>
  </main>

  <!-- CART PANEL -->
  <aside id="cartPanel" class="cart-panel" aria-hidden="true" role="dialog" aria-labelledby="cartTitle">
    <div class="cart-header">
      <span id="cartTitle">Shopping Cart</span>
      <button id="btnCloseCart" aria-label="Close cart" style="background:none;border:none;color:black;font-size:18px;cursor:pointer;">✕</button>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div id="cartTotal" class="cart-total">Rs. 0.00</div>
    <button id="btnCheckout" class="btn-checkout">Checkout</button>
  </aside>

  <!-- IMAGE MODAL -->
  <div id="imgModal" class="img-modal" role="dialog" aria-modal="true" aria-label="Image preview">
    <button id="btnCloseImg">✕</button>
    <img id="modalImg" alt="Product image full view">
  </div>

<script>
const SPREADSHEET_ID = '1EVx4ZUqKdpKctQwhnbuH6s2vA9Sx3kwnFop0NQID2eI';
const GID = '0';
const noticeEl = document.getElementById('notice');
const gridEl = document.getElementById('grid');
const btnCart = document.getElementById('btnCart');
const cartPanel = document.getElementById('cartPanel');
const btnCloseCart = document.getElementById('btnCloseCart');
const cartItemsEl = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');
let cart = [];

/* ===== Accessibility helpers ===== */
function openCart(){
  cartPanel.classList.add('open');
  cartPanel.setAttribute('aria-hidden', 'false');
  btnCloseCart.focus();
}
function closeCart(){
  cartPanel.classList.remove('open');
  cartPanel.setAttribute('aria-hidden', 'true');
  btnCart.focus();
}

/* ===== Cart functions ===== */
function updateCart(){
  cartItemsEl.innerHTML = '';
  let total = 0;
  if(cart.length === 0){
    cartItemsEl.innerHTML = '<p>No items in cart.</p>';
  }else{
    cart.forEach(item=>{
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.textContent = `${item.name} - Rs. ${item.price}`;
      cartItemsEl.appendChild(div);
      total += parseFloat(item.price)||0;
    });
  }
  cartTotalEl.textContent = `Rs. ${total.toFixed(2)}`;
  btnCart.textContent = `Cart (${cart.length})`;
}
btnCart.addEventListener('click', openCart);
btnCloseCart.addEventListener('click', closeCart);

/* ===== Google Sheet fetch ===== */
function normalizeDriveURL(url){
  if(!url) return '';
  if(/\.(png|jpe?g|gif|webp|svg)(\?.*)?$/i.test(url)) return url;
  if(url.includes('lh3.googleusercontent.com')) return url;
  const m = url.match(/[-\w]{25,}/);
  return m ? `https://drive.google.com/thumbnail?id=${m[0]}&sz=w1000` : url;
}
function extractImgSrcFromHtml(html){
  const m = html.match(/src=['"]([^'"]+)['"]/i);
  return m ? m[1] : '';
}
function gvizToObjects(gviz){
  const cols = gviz.table.cols.map(c => c.label);
  return gviz.table.rows.map(r => {
    const obj={};
    r.c.forEach((c,i)=>obj[cols[i]]=c?c.v:'');
    return obj;
  });
}
window.google = window.google||{};
window.google.visualization = {Query:{setResponse(resp){
  const data = gvizToObjects(resp);
  renderProducts(data);
}}};
function loadSheet(){
  const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;
  const s = document.createElement('script');
  s.src=url;
  s.onerror=()=>noticeEl.textContent='Failed to load sheet.';
  document.head.appendChild(s);
}

/* ===== Render Products ===== */
function renderProducts(rows){
  gridEl.innerHTML='';
  const keys = Object.keys(rows[0]);
  const nameKey = keys.find(k=>/name/i.test(k));
  const priceKey = keys.find(k=>/price/i.test(k));
  const imgKey = keys.find(k=>/image/i.test(k));
  const descKey = keys.find(k=>/desc/i.test(k));

  rows.forEach((r,idx)=>{
    const card=document.createElement('article');
    card.className='card';
    const head=document.createElement('div');
    head.className='card-head';
    head.textContent=r[nameKey];
    card.appendChild(head);

    const imgWrap=document.createElement('div');
    imgWrap.className='img-wrap';
    const img=document.createElement('img');
    img.className='thumb';
    img.src=normalizeDriveURL(r[imgKey]);
    img.alt=r[nameKey];
    imgWrap.appendChild(img);
    card.appendChild(imgWrap);

    const body=document.createElement('div');
    body.className='card-body';
    const price=document.createElement('div');
    price.className='price';
    price.textContent=`Rs. ${r[priceKey]}`;
    body.appendChild(price);
    const desc=document.createElement('div');
    desc.className='desc';
    desc.textContent=r[descKey];
    body.appendChild(desc);

    const btn=document.createElement('button');
    btn.className='btn-add';
    btn.textContent='Add to Cart';
    btn.addEventListener('click',()=>{
      cart.push({name:r[nameKey],price:r[priceKey]});
      updateCart();
    });
    body.appendChild(btn);

    card.appendChild(body);
    gridEl.appendChild(card);

    /* image click full screen */
    img.addEventListener('click',()=>{
      showImageModal(img.src, r[nameKey]);
    });
  });
  noticeEl.textContent=`Loaded ${rows.length} products.`;
}

/* ===== Image modal ===== */
const imgModal=document.getElementById('imgModal');
const modalImg=document.getElementById('modalImg');
const btnCloseImg=document.getElementById('btnCloseImg');
function showImageModal(src,alt){
  modalImg.src=src;
  modalImg.alt=alt;
  imgModal.classList.add('open');
  btnCloseImg.focus();
}
function closeImageModal(){
  imgModal.classList.remove('open');
}
btnCloseImg.addEventListener('click',closeImageModal);
imgModal.addEventListener('click',(e)=>{ if(e.target===imgModal) closeImageModal(); });
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeImageModal(); });

/* Start */
loadSheet();
</script>
</body>
</html>
